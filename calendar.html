<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Datepicker template</title>
	<link rel="stylesheet" href="/dependencies/css/bootstrap.min.css">
	<link rel="stylesheet" href="calendar.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

</head>
<body>

<div id='calendar' tabindex='0' class='popover' style='display: block; outline: none'></div>

<script id="calendar-template" type="text/template">
	<div class='arrow'></div>                        
	<h3 class='popover-title'>{{calendarTitle}}</h3>
	<div class='dropdown month-dropdown pull-left'>
		<button class='btn btn-default dropdown-toggle' type='button' data-toggle='dropdown' aria-expanded='true'> 
			<span class='fa-chevron-circle-down'></span> 
			<span class='current-month'>{{currentMonth}}</span>       
		</button> 
		<ul class='dropdown-menu month-dropdown' role='menu'>
			{{#monthNames}}
			<li><a>{{.}}</a></li>
			{{/monthNames}}
		</ul>              
	</div>                                                       
	<div class='dropdown year-dropdown pull-right'>
		<button class='btn btn-default dropdown-toggle' type='button' data-toggle='dropdown' aria-expanded='true'>
			<span class='current-year'>{{currentYear}}</span>
			<span class='fa-chevron-circle-down'></span>
		</button>                                      
		<ul class='dropdown-menu year-dropdown' role='menu'>
			{{#years}}
			<li><a>{{.}}</a></li>
			{{/years}}
		</ul>              
	</div>                                                       
	<div class='calendar-content popover-content'>
		<table class='table calendar-table'>       
			<thead>
				<tr>
					{{#weekdays}}
					<td>{{.}}</td>
					{{/weekdays}}
				</tr>
			</thead>

			<tbody>
				{{#currentContent}}
				<tr>
					{{#.}}
					<td>{{.}}</td>
					{{/.}}
				</tr>
				{{/currentContent}}
			</tbody>                                   
		</table>
	</div> 
	<div class='popover-footer col-xs-12'>
		<div class=" col-xs-6">
			<input id='start' class='datepickerInput form-control input-sm' type="text" placeholder='Anreise' value={{startDate}}>
		</div>
		<div class="col-xs-6">
			<input id='start' class='datepickerInput form-control input-sm' type="text" placeholder='Abreise' value={{endDate}}>
		</div>
	</div>   
</script>

	<script src="/dependencies/js/jquery.min.js"></script>
	<script src="/dependencies/js/moment.min.js"></script>
	<script src="/dependencies/js/mustache.min.js"></script>
	<script src="/dependencies/js/bootstrap.min.js"></script>
	<script src="calendarlogic.js"></script>
	<script>
		$(document).ready(function(){
			var calendar = new Calendar({
				calendarTitle: 'SteinwÃ¤ldchen'
			});


			var $calendar = $('#calendar');
			var $template = $('#calendar-template');

			function render(){
				var html = Mustache.render($template.html(), calendar);
				Mustache.parse(html); 
				$calendar.html(html);

				var $monthList = $calendar.find('.month-dropdown li');
				$monthList.on('click', monthSelect);

				var $yearList = $calendar.find('.year-dropdown li');
				$yearList.on('click', yearSelect);

				var $days = $calendar.find('.calendar-table tbody tr');
				$days.on('click', 'td', daySelect);


				// issues come back and its gone
				$days.find(':contains(' + calendar.currentDay + '):first').addClass('today');


			}

			render();

			function monthSelect(e){
				var $this = $(this);
				var month = $this.find('a').html();
				calendar.setMonth(month);
				calendar.updateCalendar();
				render();
			}

			function yearSelect(e){
				var $this = $(this);
				var year = $this.find('a').html();
				calendar.setYear(year);
				calendar.updateCalendar();
				render();
			}

			var dayClicks = 0;
			function daySelect(e){

				var $this = $(this);
				var day = $this.html();
				calendar.setDay(day);

				// change to if(startDate), if(endDate), if(startDate && endDate), if(startDate > endDate)...
				if(dayClicks == 0){
					$this.addClass('start');
					// update calendar.startDate
					dayClicks++;
				} else if($this.hasClass('start')){
					$this.removeClass('start');
					dayClicks--;
				} else if($this.hasClass('end')){
					$this.removeClass('end');
					dayClicks--;
				} else{
					$this.addClass('end');
					// update calendar.endDate
					// update calendar.interval
					// $interval.addClass('interval');
					dayClicks++;
				}
				
			}




		});
	</script>
</body>
</html>